"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.symESMCache = exports.symESMInstrumentations = void 0;
exports.addCJSInstrumentation = addCJSInstrumentation;
exports.addESMInstrumentation = addESMInstrumentation;
exports.getESMInstrumentedModules = getESMInstrumentedModules;
const symCJSInstrumentations = Symbol.for('_weave_cjs_instrumentations');
exports.symESMInstrumentations = Symbol.for('_weave_esm_instrumentations');
exports.symESMCache = Symbol.for('_weave_esm_cached_patched');
global[symCJSInstrumentations] =
    global[symCJSInstrumentations] ||
        // key is the module name and sub path(lookup key),
        // value is an array of instrumentations pinned to an expected version range of the module
        new Map();
global[exports.symESMCache] =
    global[exports.symESMCache] || new Map();
exports.default = global[symCJSInstrumentations];
global[exports.symESMInstrumentations] =
    global[exports.symESMInstrumentations] ||
        // key is the module name (lookup key),
        // value is an array of instrumentations pinned to an expected version range of the module
        new Map();
function addCJSInstrumentation({ moduleName, subPath, version, hook, }) {
    const instrumentations = global[symCJSInstrumentations];
    const instrumentationLookupKey = `${moduleName}@${subPath}`;
    if (!instrumentations.has(instrumentationLookupKey)) {
        instrumentations.set(instrumentationLookupKey, []);
    }
    instrumentations.get(instrumentationLookupKey).push({
        version,
        hook,
    });
}
function addESMInstrumentation({ moduleName, version, hook, }) {
    const instrumentations = global[exports.symESMInstrumentations];
    if (!instrumentations.has(moduleName)) {
        instrumentations.set(moduleName, []);
    }
    instrumentations.get(moduleName).push({
        version,
        hook,
    });
}
function getESMInstrumentedModules() {
    const instrumentations = global[exports.symESMInstrumentations];
    return Array.from(instrumentations.keys());
}
//# sourceMappingURL=instrumentations.js.map